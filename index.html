<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Gyazo芋蔓検索</title>
<style type="text/css">
img.sim {
  margin: 2pt;
  height:120;
}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript">
var sim = {};
var data = {};
var ids = [];
var tfidf = {};
var src;

$(function() {
  topimage = $('<img>');
  topimage.attr('height','160pt');
  topimage.attr('id','src');
  topimage.css('float','left');
  topimage.css('margin','4pt');
  $('body').append(topimage);

  query = $('<input>');
  query.attr('type','text');
  query.css('width','100%');
  query.attr('id','query');
  $('body').append(query);
  $('body').append($('<br clear="all">'));

  div = $('<div>');
  div.attr('height','160pt');
  div.attr('id','comments');
  div.css('margin','4pt');
  div.css('overflow','hidden');
  div.css('float','left');
  //$('body').append(div);

  //textarea = $('<textarea>');
  //textarea.css('height','120pt');
  //textarea.css('width','400pt');
  //textarea.attr('id','comments');
  //$('body').append(textarea);

  //$('body').append($('<br clear="all">'));
  //$('body').append($('<hr>'));
  for(var i=0;i<40;i++){
    image = $('<img>');
    image.attr('id','sim'+i);
    image.attr('class','sim');
    $('body').append(image);
  }

  $.getJSON("./data.json", function(json){
    data = json;
    $.getJSON("./sim.json", function(json){
      sim = json;
      keys = [];
      for (var k in sim){
        keys.push(k)
      }
      ind = Math.floor(Math.random() * keys.length);
      src = keys[ind];
      display();
    });
  });

  //$.getJSON("./ids.json", function(json){
  //  ids = json;
  //  $.getJSON("./tfidf.json", function(json){
  //    tfidf = json;
  //  });
  //});

  $("img").on("click", function(){
    src = $(this).attr('gyazoid');
    display();
  });

  $("#query").on("keydown", function(e){
    if(e.keyCode == 13){
      search($('#query').val());
    }
  });
});

function search(query){
  $('#src').css('display','none');
  results = [];
  for(d in data){
    keywords = data[d]['keywords'];
    for(var i=0;i<keywords.length;i++){
      if(keywords[i].match(query)){
        results.push(d);
        break;
      }
    }
    if(results.length > 40) break;
  }
  for(i=0;i<40;i++){
    $('#sim'+i).css('display',"none");
  }
  for(i=0;i<results.length;i++){
    $('#sim'+i).css('display',"inline");
    $('#sim'+i).attr('src',"http://gyazo.com/"+results[i]+".png");
    $('#sim'+i).attr('gyazoid',results[i]);
    $('#sim'+i).attr('title',data[results[i]]['keywords'].join(", "));
  }
}

function display(){
  $('#src').css('display','block');
  $('#src').attr('src',"http://gyazo.com/"+src+".png");
  if(data[src]){
    // $('#comments').text(data[src]['keywords'].join(", "));
    $('#query').val(data[src]['keywords'].join(", "));
  }
  simimages = sim[src];
  for(i=0;i<40;i++){
    $('#sim'+i).css('display',"none");
  }
  for(i=0;i<40;i++){
    $('#sim'+i).attr('src',"http://gyazo.com/"+sim[src][i]+".png");
    $('#sim'+i).attr('gyazoid',sim[src][i]);
    $('#sim'+i).attr('title',data[sim[src][i]]['keywords'].join(", "));
    $('#sim'+i).css('display',"inline");
  }
}

</script>

</head>
<body>
</body>
</html>


